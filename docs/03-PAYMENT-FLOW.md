# Ã–deme AkÄ±ÅŸÄ±

<div align="center">

## ğŸ’³ Payment Flow Documentation

**UÃ§tan Uca Ã–deme SenaryolarÄ±**

---

</div>

## ğŸ“‹ Genel BakÄ±ÅŸ

Payment Gateway, **4 aÅŸamalÄ±** bir Ã¶deme modeli kullanÄ±r:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CREATE  â”‚â”€â”€â”€â–¶â”‚ AUTHORIZE  â”‚â”€â”€â”€â–¶â”‚ CAPTURE  â”‚â”€â”€â”€â–¶â”‚  REFUND  â”‚
â”‚          â”‚    â”‚            â”‚    â”‚          â”‚    â”‚          â”‚
â”‚  Ã–deme   â”‚    â”‚  Kart      â”‚    â”‚  TutarÄ±  â”‚    â”‚  Ä°ade    â”‚
â”‚  KaydÄ±   â”‚    â”‚  Blokesi   â”‚    â”‚  Ã‡ekme   â”‚    â”‚  Ä°ÅŸlemi  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¬ Senaryo: E-Ticaret Ã–demesi

### KullanÄ±cÄ± Hikayesi
> AyÅŸe, online maÄŸazadan 1.500 TL'lik bir laptop satÄ±n almak istiyor.

---

## 1ï¸âƒ£ AÅŸama: Ã–deme OluÅŸturma (Create)

### AkÄ±ÅŸ DiyagramÄ±

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MÃ¼ÅŸteri   â”‚         â”‚   Gateway   â”‚         â”‚  VeritabanÄ± â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                       â”‚                       â”‚
       â”‚  Sepeti Onayla        â”‚                       â”‚
       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                       â”‚
       â”‚                       â”‚                       â”‚
       â”‚                       â”‚  Ã–deme KaydÄ± OluÅŸtur  â”‚
       â”‚                       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
       â”‚                       â”‚                       â”‚
       â”‚                       â”‚     Payment ID       â”‚
       â”‚                       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
       â”‚                       â”‚                       â”‚
       â”‚   payment_id: xxx     â”‚                       â”‚
       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                       â”‚
       â”‚                       â”‚                       â”‚
```

### API Ä°steÄŸi

```http
POST /v1/payments
Content-Type: application/json
X-Merchant-Id: TRENDYOL
Idempotency-Key: order-12345-payment

{
  "amount": 1500.00,
  "currency": "TRY",
  "orderId": "ORDER-12345",
  "customerEmail": "ayse@email.com",
  "description": "Laptop - Model XYZ"
}
```

### API YanÄ±tÄ±

```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "merchantId": "TRENDYOL",
  "amount": 1500.00,
  "currency": "TRY",
  "orderId": "ORDER-12345",
  "status": "CREATED",
  "createdAt": "2026-02-02T10:00:00Z"
}
```

### Durum DeÄŸiÅŸimi
```
NULL â”€â”€â–¶ CREATED
```

---

## 2ï¸âƒ£ AÅŸama: Yetkilendirme (Authorize)

### AkÄ±ÅŸ DiyagramÄ±

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MÃ¼ÅŸteri   â”‚    â”‚   Gateway   â”‚    â”‚   Routing   â”‚    â”‚    Banka    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                  â”‚                  â”‚                  â”‚
       â”‚  Kart Bilgisi    â”‚                  â”‚                  â”‚
       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                  â”‚                  â”‚
       â”‚                  â”‚                  â”‚                  â”‚
       â”‚                  â”‚  BIN Analizi     â”‚                  â”‚
       â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                  â”‚
       â”‚                  â”‚                  â”‚                  â”‚
       â”‚                  â”‚  Provider: GARANTÄ°                  â”‚
       â”‚                  â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚
       â”‚                  â”‚                  â”‚                  â”‚
       â”‚                  â”‚  Authorize Request                  â”‚
       â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
       â”‚                  â”‚                  â”‚                  â”‚
       â”‚                  â”‚                  â”‚  Tutar Bloke    â”‚
       â”‚                  â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
       â”‚                  â”‚                  â”‚                  â”‚
       â”‚  AUTHORIZED      â”‚                  â”‚                  â”‚
       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚                  â”‚
       â”‚                  â”‚                  â”‚                  â”‚
```

### Routing KararÄ±

| Kart BIN | Banka | SeÃ§ilen Provider | Komisyon | Neden |
|----------|-------|------------------|----------|-------|
| **454678** | Garanti | GARANTI_VPOS | **0.99%** | ON-US (AynÄ± banka) |
| 549220 | YapÄ± Kredi | YAPIKREDI_VPOS | 1.09% | ON-US |
| 540668 | Ä°ÅŸ BankasÄ± | ISBANK_VPOS | 1.19% | ON-US |
| DiÄŸer | - | Default Provider | 1.99% | Fallback |

### API Ä°steÄŸi

```http
POST /v1/payments/550e8400-e29b-41d4-a716-446655440000/authorize
Content-Type: application/json
X-Merchant-Id: TRENDYOL
Idempotency-Key: order-12345-auth

{
  "cardToken": "tok_xxxxxxxxxxxx",
  "cardBin": "454678",
  "threeDsPreference": "WHEN_REQUIRED"
}
```

### BaÅŸarÄ±lÄ± YanÄ±t

```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "status": "AUTHORIZED",
  "providerReference": "GRN-2026020210001234",
  "updatedAt": "2026-02-02T10:00:15Z"
}
```

### Durum DeÄŸiÅŸimi
```
CREATED â”€â”€â–¶ AUTHORIZED
```

> ğŸ’¡ **Not:** Bu aÅŸamada mÃ¼ÅŸterinin kartÄ±ndan 1.500 TL **bloke edilir** ama henÃ¼z Ã§ekilmez.

---

## ğŸ” Alternatif: 3D Secure AkÄ±ÅŸÄ±

BazÄ± durumlarda banka 3DS doÄŸrulamasÄ± ister:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MÃ¼ÅŸteri   â”‚    â”‚   Gateway   â”‚    â”‚    Banka    â”‚    â”‚  3DS Page   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                  â”‚                  â”‚                  â”‚
       â”‚  Authorize       â”‚                  â”‚                  â”‚
       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                  â”‚                  â”‚
       â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                  â”‚
       â”‚                  â”‚                  â”‚                  â”‚
       â”‚                  â”‚  REQUIRES_3DS    â”‚                  â”‚
       â”‚                  â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚
       â”‚                  â”‚                  â”‚                  â”‚
       â”‚  3DS URL         â”‚                  â”‚                  â”‚
       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚                  â”‚
       â”‚                  â”‚                  â”‚                  â”‚
       â”‚  Redirect        â”‚                  â”‚                  â”‚
       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
       â”‚                  â”‚                  â”‚                  â”‚
       â”‚                  â”‚                  â”‚     OTP Gir      â”‚
       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
       â”‚                  â”‚                  â”‚                  â”‚
       â”‚  OTP: 111111     â”‚                  â”‚                  â”‚
       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
       â”‚                  â”‚                  â”‚                  â”‚
       â”‚                  â”‚                  â”‚    Verified      â”‚
       â”‚                  â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
       â”‚                  â”‚                  â”‚                  â”‚
       â”‚  Success         â”‚                  â”‚                  â”‚
       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚                  â”‚
```

### 3DS YanÄ±tÄ±

```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "status": "CREATED",
  "threeDsRequired": true,
  "threeDsUrl": "https://gateway.com/3ds/verify?session=abc123"
}
```

---

## 3ï¸âƒ£ AÅŸama: Ã‡ekim (Capture)

### AkÄ±ÅŸ DiyagramÄ±

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Merchant  â”‚         â”‚   Gateway   â”‚         â”‚    Banka    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                       â”‚                       â”‚
       â”‚  ÃœrÃ¼n Kargoya Verildi â”‚                       â”‚
       â”‚  Capture Ä°steÄŸi       â”‚                       â”‚
       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                       â”‚
       â”‚                       â”‚                       â”‚
       â”‚                       â”‚  Capture Request      â”‚
       â”‚                       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
       â”‚                       â”‚                       â”‚
       â”‚                       â”‚  Tutar Transfer       â”‚
       â”‚                       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
       â”‚                       â”‚                       â”‚
       â”‚   CAPTURED            â”‚                       â”‚
       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                       â”‚
       â”‚                       â”‚                       â”‚
```

### API Ä°steÄŸi

```http
POST /v1/payments/550e8400-e29b-41d4-a716-446655440000/capture
Content-Type: application/json
X-Merchant-Id: TRENDYOL

{
  "amount": 1500.00
}
```

### API YanÄ±tÄ±

```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "status": "CAPTURED",
  "amount": 1500.00,
  "providerReference": "GRN-2026020210001234",
  "updatedAt": "2026-02-02T14:30:00Z"
}
```

### Durum DeÄŸiÅŸimi
```
AUTHORIZED â”€â”€â–¶ CAPTURED
```

> ğŸ’° **Not:** Bu aÅŸamada 1.500 TL mÃ¼ÅŸterinin kartÄ±ndan **Ã§ekilir** ve merchant hesabÄ±na aktarÄ±lÄ±r.

---

## 4ï¸âƒ£ AÅŸama: Ä°ade (Refund)

### Senaryo
> AyÅŸe laptoptan memnun kalmadÄ± ve iade etmek istiyor.

### Tam Ä°ade

```http
POST /v1/payments/550e8400-e29b-41d4-a716-446655440000/refund
Content-Type: application/json
X-Merchant-Id: TRENDYOL

{
  "reason": "MÃ¼ÅŸteri iade talebi - Ã¼rÃ¼n iade edildi"
}
```

### KÄ±smi Ä°ade

```http
POST /v1/payments/550e8400-e29b-41d4-a716-446655440000/refund
Content-Type: application/json
X-Merchant-Id: TRENDYOL

{
  "amount": 500.00,
  "reason": "KÄ±smi iade - aksesuarlar iade edildi"
}
```

### API YanÄ±tÄ±

```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "status": "REFUNDED",
  "amount": 1500.00,
  "refundedAmount": 1500.00,
  "updatedAt": "2026-02-05T09:00:00Z"
}
```

### Durum DeÄŸiÅŸimi
```
CAPTURED â”€â”€â–¶ PARTIALLY_REFUNDED â”€â”€â–¶ REFUNDED
```

---

## ğŸ“Š Durum Makinesi (State Machine)

```
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚   CREATED   â”‚
                              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                â”‚                â”‚
                    â–¼                â–¼                â–¼
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚  FAILED   â”‚    â”‚AUTHORIZED â”‚    â”‚  EXPIRED  â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚               â”‚               â”‚
                    â–¼               â–¼               â–¼
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚  FAILED   â”‚   â”‚ CAPTURED  â”‚   â”‚  VOIDED   â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚              â”‚              â”‚
                    â–¼              â–¼              â–¼
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚  FAILED   â”‚  â”‚ PARTIALLY â”‚  â”‚ REFUNDED  â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ REFUNDED  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¬ Webhook Bildirimleri

Her durum deÄŸiÅŸikliÄŸinde merchant'a webhook gÃ¶nderilir:

### Webhook Payload

```json
{
  "eventId": "evt_xxxxxxxxxxxx",
  "eventType": "PaymentCaptured",
  "timestamp": "2026-02-02T14:30:00Z",
  "data": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "merchantId": "TRENDYOL",
    "status": "CAPTURED",
    "amount": 1500.00,
    "currency": "TRY",
    "orderId": "ORDER-12345"
  }
}
```

### Webhook Headers

```http
POST https://merchant.com/webhooks/payment
Content-Type: application/json
X-Webhook-Id: evt_xxxxxxxxxxxx
X-Webhook-Signature: sha256=xxxxxxxxxxxxxxxx
X-Webhook-Timestamp: 1706875800
```

### Event TÃ¼rleri

| Event | Tetiklenme AnÄ± |
|-------|----------------|
| `PaymentCreated` | Ã–deme oluÅŸturulduÄŸunda |
| `PaymentAuthorized` | Kart blokesi yapÄ±ldÄ±ÄŸÄ±nda |
| `PaymentCaptured` | Tutar Ã§ekildiÄŸinde |
| `PaymentRefunded` | Ä°ade yapÄ±ldÄ±ÄŸÄ±nda |
| `PaymentFailed` | Ä°ÅŸlem baÅŸarÄ±sÄ±z olduÄŸunda |

---

## â±ï¸ Zaman Ã‡izelgesi

```
GÃ¼n 1                    GÃ¼n 2                    GÃ¼n 5
10:00                    14:30                    09:00
  â”‚                        â”‚                        â”‚
  â”‚                        â”‚                        â”‚
  â–¼                        â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CREATE  â”‚            â”‚ CAPTURE â”‚            â”‚ REFUND  â”‚
â”‚   +     â”‚            â”‚         â”‚            â”‚         â”‚
â”‚AUTHORIZEâ”‚            â”‚ Kargoya â”‚            â”‚ Ä°ade    â”‚
â”‚         â”‚            â”‚ verildi â”‚            â”‚ talebi  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                      â”‚                      â”‚
     â”‚    1500 TL           â”‚    1500 TL           â”‚    1500 TL
     â”‚    BLOKE             â”‚    Ã‡EKÄ°LDÄ°           â”‚    Ä°ADE
     â–¼                      â–¼                      â–¼
```

---

## ğŸ¯ Best Practices

### 1. Idempotency Key KullanÄ±mÄ±
```
Her iÅŸlem iÃ§in benzersiz Idempotency-Key gÃ¶nderin.
Ã–rnek: {orderId}-{operation}-{timestamp}
```

### 2. Authorize/Capture AyrÄ±mÄ±
```
âœ… DoÄŸru: ÃœrÃ¼n kargoya verilince Capture
âŒ YanlÄ±ÅŸ: Hemen Capture (iade zorlaÅŸÄ±r)
```

### 3. KÄ±smi Capture
```
1500 TL authorize edildi
Stokta sadece 1000 TL'lik Ã¼rÃ¼n var
â†’ 1000 TL capture, 500 TL void
```

### 4. Webhook DoÄŸrulama
```
Signature doÄŸrulamasÄ± yapÄ±n
Replay attack'lara karÅŸÄ± timestamp kontrolÃ¼
```

---

<div align="center">

[â† Mimari](./02-ARCHITECTURE.md) | [GÃ¼venlik â†’](./04-SECURITY.md)

</div>
